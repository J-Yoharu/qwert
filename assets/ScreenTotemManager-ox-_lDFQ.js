var ye=Object.defineProperty;var ke=(n,t,e)=>t in n?ye(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var z=(n,t,e)=>(ke(n,typeof t!="symbol"?t+"":t,e),e);import{c as $,Y as G,a0 as v,a1 as w,a2 as i,h as l,b2 as ae,af as T,ac as D,av as oe,a8 as B,a4 as E,bn as M,a6 as k,a7 as A,F as R,b0 as se,b5 as we,aF as $e,aG as Ie,r as y,w as re,am as ie,aE as Q,a5 as U,bp as de,aY as ce,aZ as ue,an as j,ae as me,V as fe,ab as L,aW as Y,a$ as ne,ad as Fe,ah as Be,aq as Pe,bo as De,T as Ne,o as Oe,i as qe,b3 as Ue,bq as Ee}from"./index-CDl_QKVk.js";import{_ as K}from"./Form.vue_vue_type_script_setup_true_lang-BaCq78p9.js";import{c as Ae,d as W,_ as Re}from"./default-data-CeKDSC61.js";import{V as Ge,a as Me}from"./Welcome-BlWxVGd8.js";import{a as je,b as Le,f as Je,e as ze}from"./totem.repository-BH7pn9c0.js";import{_ as pe}from"./Dialog.vue_vue_type_script_setup_true_lang-DRnDC6on.js";import{a as N,V as J}from"./VRow-Bt3TskwR.js";import{V as We}from"./VForm-CGAQok5a.js";import{b as X,V as Z}from"./VList-9HnQ1n-1.js";import{V as Ye}from"./validator-yckjBK8X.js";import{V as Ke}from"./VSlideGroup-DjE8cQEw.js";import{V as Xe}from"./VSlideGroupItem-BvNpeO4x.js";import{V as Ze}from"./VTooltip-JSQoz77F.js";import"./filter-c6zobYp7.js";import"./VTextField-C3d9AFbr.js";import"./VSheet-B4KFF7X7.js";import"./VWindowItem-DpZurtrP.js";import"./ssrBoot-CeZ-lE3a.js";import"./Init.vue_vue_type_script_setup_true_lang-BZak_Yxz.js";function He(n){const t={};for(const e of n){const s=e.split(".");let c=t;for(const p of s){const m=p.split(",");for(const b of m)c[b]||(c[b]={});m.length>1?c=t:c=c[m[0]]}}return t}function H(n,t,e){if(Array.isArray(n))n.forEach((s,c)=>{n[c]=H(s,t,e)});else for(const s in t)n.hasOwnProperty(s)&&(e&&e(n[s],s)||Object.keys(t[s]).length===0?delete n[s]:typeof n[s]=="object"&&n[s]!==null&&(n[s]=H(n[s],t[s],e)));return n}function Qe(n,t,e){const s=He(t),c=JSON.parse(JSON.stringify(n));return H(c,s,e)}function et(n,t,e){return $({get:()=>n[t],set:s=>{e(`update:${t}`,s)}})}class ee{constructor(t,e){z(this,"props");z(this,"emit");this.props=t,this.emit=e}create(t){return et(this.props,t,this.emit)}many(t){return t.map(e=>this.create(e))}}const tt=G({__name:"ScreenPreviewDialog",props:{screens:{},modelValue:{type:Boolean},actualScreenIndex:{}},emits:["update:modelValue","update:actualScreenIndex"],setup(n,{emit:t}){const e=n,s=t,c=new ee(e,s),[p,m]=c.many(["modelValue","actualScreenIndex"]),b=$(()=>e.screens[m.value]);return(_,d)=>(v(),w(we,{modelValue:E(p),"onUpdate:modelValue":d[3]||(d[3]=o=>M(p)?p.value=o:null)},{default:i(()=>[l(se,null,{default:i(()=>[l(ae,{class:"d-flex align-center bg-primary"},{default:i(()=>[T("h2",null,D(b.value.name),1),l(oe),l(B,{icon:"mdi-close",variant:"plain",onClick:d[0]||(d[0]=o=>p.value=!1)})]),_:1}),l(Ge,{modelValue:E(m),"onUpdate:modelValue":d[2]||(d[2]=o=>M(m)?m.value=o:null)},{default:i(()=>[(v(!0),k(R,null,A(_.screens,o=>(v(),w(Me,null,{default:i(()=>[(v(),w($e(E(Ae)[o.component]),{class:"pointer-none",modelValue:E(W),"onUpdate:modelValue":d[1]||(d[1]=C=>M(W)?W.value=C:null)},null,8,["modelValue"]))]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}}),lt="screen";function nt(){return Ie.get(`/${lt}`)}const at={};function ot(n,t){let e=at[n]??!1;return e?e=e[t.data.slug]:e={component:"VTextField"},Object.assign({},e,{value:t.data.key,label:t.data.label},{required:t.required,order:t.order,props:{disabled:!t.editable}})}const st=T("h4",null,"Configurações",-1),rt={class:"flex-grow-1"},it=T("h4",null,"Preview",-1),dt=G({__name:"ScreenTotemFieldConfigDialog",props:{modelValue:{type:Boolean},screenTotemField:{},screenTotem:{}},emits:["update:modelValue","save"],setup(n,{emit:t}){const e=y({}),s=n,c=t,m=new ee(s,c).create("modelValue"),b=y({editable:1,field_id:0,order:0,required:1,screen_totem_id:0,data:{id:0,label:"",slug:"",key:"",description:"",group_id:0,updated_at:"",created_at:""}}),_=y({label:"",value:"",component:"VTextField",props:{}}),d=y([{component:"VSwitch",value:"editable",label:"O campo é editável",props:{trueValue:1,falseValue:0},cols:{cols:6,md:12}},{component:"VSwitch",value:"required",label:"O campo é obrigatório?",props:{trueValue:1,falseValue:0},cols:{cols:6,md:12}},{component:"VTextField",value:"order",label:"Ordenação do campo",required:!0,props:{type:"number",disabled:$(()=>s.screenTotem.fields.length===1),rules:$(()=>`between:1,${s.screenTotem.fields.length}`),trueValue:1,falseValue:0}}]);function o(){c("save",b.value)}return re(()=>m.value,()=>{if(m.value){b.value={...s.screenTotemField};const C=ot(s.screenTotem.data.component,b.value);_.value=Object.assign(C,{required:$(()=>b.value.required),props:{disabled:$(()=>!b.value.editable)},cols:{cols:12,md:12}})}},{immediate:!0}),(C,g)=>(v(),w(pe,{"cancel-reset":"",onSubmit:o,width:"600",title:"Configurar campo",modelValue:E(m),"onUpdate:modelValue":g[2]||(g[2]=x=>M(m)?m.value=x:null)},{default:i(()=>[l(J,null,{default:i(()=>[l(N,{cols:"12",md:"6"},{default:i(()=>[st,l(K,{modelValue:b.value,"onUpdate:modelValue":g[0]||(g[0]=x=>b.value=x),form:d.value},null,8,["modelValue","form"])]),_:1}),l(N,{cols:"12",md:"6",class:"d-flex flex-row"},{default:i(()=>[l(ie,{class:"fill-height mr-2 d-sm-none d-md-block",vertical:""}),T("div",rt,[it,T("div",null,[l(We,null,{default:i(()=>[l(K,{modelValue:e.value,"onUpdate:modelValue":g[1]||(g[1]=x=>e.value=x),form:[_.value]},null,8,["modelValue","form"])]),_:1})])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ve=n=>(ce("data-v-1654a882"),n=n(),ue(),n),ct={style:{height:"30%"}},ut=ve(()=>T("h3",null,"Campos disponíveis",-1)),mt={key:0,class:"text-center"},ft=ve(()=>T("h3",null,"Campos selecionados",-1)),pt={class:"d-flex flex-column mr-2"},vt={class:"mr-2"},_t={key:0,class:"text-center"},ht=G({__name:"ScreenTotemFieldConfig",props:{screenTotem:{}},emits:["deleteField"],setup(n,{emit:t}){const e=n,s=t,c=y(!1),p=$(()=>e.screenTotem.data.fields.filter(h=>!e.screenTotem.fields.find(V=>V.field_id===h.id))),{openDeleteAlert:m,closeAlert:b}=Q(),_=y({editable:1,field_id:0,order:0,required:1,screen_totem_id:0,data:{id:0,label:"",slug:"",key:"",description:"",group_id:0,updated_at:"",created_at:""}});function d(h){const V=e.screenTotem.fields.findIndex(f=>f.field_id===h.id);if(V!==-1){e.screenTotem.fields.splice(V,1);return}e.screenTotem.fields.push(o(h))}function o(h){return{editable:1,required:1,field_id:h.id,screen_totem_id:0,data:h,order:e.screenTotem.fields.length+1}}function C(h){_.value=h,c.value=!0}function g(h){const V=e.screenTotem.fields.findIndex(S=>S.field_id===h.field_id),f=e.screenTotem.fields[V];if(f.screen_totem_id===0){x(V);return}m(S=>je(e.screenTotem,f).then(()=>{x(V),s("deleteField",f),S.value=!1,b()}))}function x(h){e.screenTotem.fields.splice(h,1),e.screenTotem.fields.forEach((V,f)=>{V.order=f+1})}function O(h){const V=h.order-1,f=_.value.order-1;e.screenTotem.fields.splice(f,1)[0],e.screenTotem.fields.splice(V,0,h),e.screenTotem.fields.forEach((S,P)=>{S.order=P+1}),c.value=!1}function q(h,V){const f=V+h;e.screenTotem.fields[V].order=f+1,e.screenTotem.fields[f].order=V+1;const S=e.screenTotem.fields.splice(V,1)[0];e.screenTotem.fields.splice(f,0,{...S})}return(h,V)=>(v(),k("div",ct,[l(J,{class:"fill-height"},{default:i(()=>[l(N,{cols:"12",md:"6",style:{"max-height":"100%"},class:"d-flex flex-column"},{default:i(()=>[ut,l(X,{class:"position-relative overflow-scroll"},{default:i(()=>[(v(!0),k(R,null,A(p.value,f=>(v(),w(Z,{onClick:S=>d(f),title:f.label,subtitle:f.description},null,8,["onClick","title","subtitle"]))),256))]),_:1}),p.value.length===0?(v(),k("div",mt," Não há mais campos disponíveis nessa tela ")):U("",!0)]),_:1}),l(N,{cols:"12",md:"6",style:{"max-height":"100%"},class:"d-flex flex-column"},{default:i(()=>[ft,l(X,{class:"position-relative overflow-scroll",style:{"overflow-x":"hidden"}},{default:i(()=>[l(de,{name:"list"},{default:i(()=>[(v(!0),k(R,null,A(h.screenTotem.fields,(f,S)=>(v(),w(Z,{key:f,onClick:P=>C(f),title:f.data.label,subtitle:f.data.description},{append:i(()=>[l(B,{icon:"mdi-delete",onClick:j(P=>g(f),["stop"]),variant:"text"},null,8,["onClick"])]),prepend:i(()=>[T("div",pt,[l(B,{icon:"mdi-chevron-up",variant:"text",size:"20",class:"mb-auto",disabled:S===0,onClick:P=>q(-1,S)},null,8,["disabled","onClick"]),l(B,{disabled:S===h.screenTotem.fields.length-1,onClick:P=>q(1,S),icon:"mdi-chevron-down",variant:"text",size:"20"},null,8,["disabled","onClick"])]),T("h4",vt,D(f.order),1)]),_:2},1032,["onClick","title","subtitle"]))),128))]),_:1})]),_:1}),h.screenTotem.fields.length===0?(v(),k("div",_t," Não há campos selecionados, clique na listagem da esquerda para adicionar novos campos ")):U("",!0)]),_:1})]),_:1}),l(dt,{modelValue:c.value,"onUpdate:modelValue":V[0]||(V[0]=f=>c.value=f),"screen-totem-field":_.value,"screen-totem":h.screenTotem,onSave:O},null,8,["modelValue","screen-totem-field","screen-totem"])]))}}),Vt=me(ht,[["__scopeId","data-v-1654a882"]]),bt=G({__name:"ScreenTotemTraitConfig",props:{screenTraits:{},screenTotemTraits:{},screenTotem:{}},setup(n){const t=n,e=$(()=>t.screenTraits.map(c=>({...c,enabled:t.screenTotemTraits.some(p=>p.trait_id==c.id&&p.enabled==1)})));function s(c){const p=t.screenTotemTraits.findIndex(m=>m.trait_id===c.id);p!==-1?t.screenTotemTraits[p].enabled==1?t.screenTotemTraits[p].enabled=0:t.screenTotemTraits[p].enabled=1:t.screenTotemTraits.push({data:c,trait_id:c.id,enabled:1,screen_totem_id:t.screenTotem.id})}return(c,p)=>(v(),w(J,null,{default:i(()=>[(v(!0),k(R,null,A(e.value,m=>(v(),w(N,{cols:"auto",key:m},{default:i(()=>[l(Ye,{label:m.description,"model-value":m.enabled,"true-value":!0,"false-value":!1,onClick:b=>s(m)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1}))}}),gt={class:"d-flex align-center"},Tt={class:"d-flex align-center mb-2"},xt={class:"ml-4 text-h5 font-weight-bold"},St=T("h2",{class:"mb-2"},"Formulário",-1),Ct={key:0,class:"text-center"},yt=T("h2",{class:"mb-2"}," Funcionalidades ",-1),kt={key:1,class:"text-center"},wt=G({__name:"ScreenTotemConfigDialog",props:{modelValue:{type:Boolean},screenTotem:{}},emits:["update:modelValue","screen:delete","field:remove","save"],setup(n,{emit:t}){const e=n,s=t,c=new ee(e,s),{openDeleteAlert:p,openAlert:m,closeAlert:b}=Q(),_=c.create("modelValue"),d=y({id:0,fields:[],traits:[],order:0,screen_id:0,totem_id:0,data:{id:0,name:"",fields:[],traits:[]}});function o(){if(d.value.id===0){s("screen:delete",d.value),_.value=!1;return}p(g=>{g.value=!0,Le(d.value).then(()=>{s("screen:delete",d.value),b(),_.value=!1}).catch(x=>{m("Error",x)}).finally(()=>{g.value=!1})})}function C(){s("save",d.value)}return re(()=>_.value,g=>{g&&(d.value=JSON.parse(JSON.stringify(e.screenTotem)))}),(g,x)=>(v(),w(pe,{"cancel-reset":"",onSubmit:C,height:"100%",modelValue:E(_),"onUpdate:modelValue":x[1]||(x[1]=O=>M(_)?_.value=O:null),fullscreen:""},{title:i(()=>[T("div",gt,[T("div",Tt,[l(fe,{icon:"mdi-cog"}),T("h1",xt,D(g.screenTotem.data.name),1)]),l(oe),l(B,{color:"red",variant:"tonal",onClick:o},{default:i(()=>[L("Remover tela")]),_:1})])]),default:i(()=>[St,d.value.data.fields.length===0?(v(),k("div",Ct," Não há formulários para configuração nessa tela. ")):U("",!0),Y(l(Vt,{"screen-totem":d.value,"screen-fields":d.value.data.fields,"screen-totem-fields":d.value.fields,onDeleteField:x[0]||(x[0]=O=>s("field:remove",O))},null,8,["screen-totem","screen-fields","screen-totem-fields"]),[[ne,d.value.data.fields.length>0]]),l(ie,{class:"my-4"}),yt,d.value.data.traits.length===0?(v(),k("div",kt," Não há funcionalidades para configuração nessa tela. ")):U("",!0),Y(l(bt,{"screen-totem":d.value,"screen-traits":d.value.data.traits,"screen-totem-traits":d.value.traits},null,8,["screen-totem","screen-traits","screen-totem-traits"]),[[ne,d.value.data.traits.length>0]])]),_:1},8,["modelValue"]))}}),_e=n=>(ce("data-v-84065c5d"),n=n(),ue(),n),$t=_e(()=>T("h3",null,"Telas para adicionar",-1)),It={class:"flex-grow-1 text-truncate card-title"},Ft={key:0,class:"text-center"},Bt=_e(()=>T("h3",null,"Telas atuais",-1)),Pt={class:"mr-5"},Dt={key:0,class:"text-center"},Nt=G({__name:"ScreenTotemManager",setup(n){const{setBreadcrumbs:t}=Fe(),e=Be(),s=Pe(),c=y([]),p=y({id:0,order:0,totem_id:0,screen_id:0,data:{id:0,name:"",description:"",component:void 0,traits:[],fields:[]},traits:[],fields:[]}),m=y(),b=y(null),_=y({visible:!1,screens:[],activeIndex:0,listType:""}),d=y(!1),o=y({id:0,name:"",description:"",queues:[],screens:[],site:{cd_estabelecimento:0,ds_estabelecimento:""}}),C=De({screen:""}),g=$(()=>{const r=c.value.filter(a=>{const u=C.screen?a.name.toLowerCase().includes(C.screen.toLowerCase()):!0;return!o.value.screens.some(F=>F.screen_id===a.id)&&u});return m.value&&(m.value.scrollOffset=0),r}),x=$(()=>o.value.screens.map(r=>r.data)),O=$(()=>o.value.screens.length),{openAlert:q}=Q();function h(){Je(Number(e.params.id)).then(r=>{o.value=r.data,V()}).catch(r=>{q("Erro",r)})}function V(){o.value.screens=o.value.screens.map(r=>({...r,data:Object.assign({},r.data,c.value.find(a=>a.id===r.screen_id))}))}async function f(){return nt().then(r=>{c.value=r.data}).catch(r=>{q("Erro",r)})}function S(r){const a=o.value.screens.findIndex(u=>u.data.component===r.data.component);a!==-1&&(o.value.screens[a]=r,d.value=!1)}function P(r){p.value={...r},d.value=!0}function he(r){o.value.screens.push({id:0,order:o.value.screens.length+1,totem_id:o.value.id,screen_id:r.id,data:r,traits:[],fields:[]});const a=Ve(r.component);if(a===void 0){q("Erro","Tela não encontrada");return}a.data.fields.length===0&&a.data.traits.length===0||P(a)}function te(r,a){const u=a+r;o.value.screens[a].order=u+1,o.value.screens[u].order=a+1;const I=o.value.screens.splice(a,1)[0];o.value.screens.splice(u,0,{...I}),le(),b.value=u}function Ve(r){return o.value.screens.find(a=>a.data.component===r)}function be(){b.value=null}function ge(r){const a=o.value.screens.findIndex(u=>u.id===r.id);a!==-1&&(o.value.screens.splice(a,1),le())}function Te(r){const a=p.value.fields.findIndex(u=>u.field_id===r.field_id);a!==-1&&p.value.fields.splice(a,1)}function xe(r,a){const u={totem:x.value,base:g.value};_.value.listType=r,_.value.screens=u[r],_.value.activeIndex=a,_.value.visible=!0}function Se(){s.push({name:"totem.detail",params:{id:o.value.id}})}function Ce(){const r=Qe(o.value.screens,["id","fields.screen_totem_id","traits.screen_totem_id"],a=>a===0);ze(o.value.id,r).then(()=>{s.push({name:"totem.detail",params:{id:o.value.id}})}).catch(a=>{q("Erro",a)})}function le(){o.value.screens.forEach((r,a)=>{r.order=a+1})}return Ne(()=>{t([{title:"Totens",to:{name:"totem.view"}},{title:$(()=>o.value.id?o.value.name:e.params.id),to:{name:"totem.detail",params:{id:e.params.id}}},{title:"Gerenciamento de Telas",to:""}])}),Oe(async()=>{await f(),h()}),(r,a)=>(v(),w(Re,{title:"Gerenciamento de telas"},{default:i(()=>[l(J,null,{default:i(()=>[l(N,{cols:"12"},{default:i(()=>[$t,l(K,{modelValue:C,"onUpdate:modelValue":a[0]||(a[0]=u=>C=u),form:[{label:"Buscar telas",value:"screen",component:"VTextField"}]},null,8,["modelValue"]),l(Ke,{"show-arrows":"",ref_key:"slideGroup",ref:m},{default:i(()=>[(v(!0),k(R,null,A(g.value,(u,I)=>(v(),w(Xe,null,{default:i(()=>[l(se,{onClick:F=>he(u),variant:"outlined",width:"300",height:"150","min-height":"150",class:"px-2 py-3 screen-card item"},{default:i(()=>[l(ae,{class:"d-flex justify-space-between"},{default:i(()=>[T("p",It,D(u.name),1),l(Ze,{text:"Preview",location:"bottom"},{activator:i(({props:F})=>[l(fe,qe({onClick:j(Ot=>xe("base",I),["stop"])},F,{icon:"mdi-monitor",class:"cursor-pointer clickable"}),null,16,["onClick"])]),_:2},1024)]),_:2},1024),l(Ue,null,{default:i(()=>[L(D(u.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:1},512),g.value.length?U("",!0):(v(),k("p",Ft,D(C.screen?"Nenhuma tela encontrada":"Nenhuma tela disponível"),1))]),_:1}),l(N,{cols:"12"},{default:i(()=>[Bt,Y((v(),w(X,{class:"position-relative overflow-hidden"},{default:i(()=>[l(de,{name:"list"},{default:i(()=>[(v(!0),k(R,null,A(o.value.screens,(u,I)=>(v(),w(Z,{active:b.value===I,key:u,title:u.data.name,subtitle:u.data.description,onClick:F=>P(u)},{prepend:i(()=>[T("div",null,[l(B,{block:"",variant:"text",icon:"mdi-chevron-up",disabled:I===0,onClick:j(F=>te(-1,I),["stop"])},null,8,["disabled","onClick"]),l(B,{block:"",variant:"text",icon:"mdi-chevron-down",disabled:I+1==O.value,onClick:j(F=>te(1,I),["stop"])},null,8,["disabled","onClick"])]),T("h1",Pt,D(u.order),1)]),append:i(()=>[U("",!0)]),_:2},1032,["active","title","subtitle","onClick"]))),128))]),_:1})]),_:1})),[[Ee,be]]),o.value.screens.length?U("",!0):(v(),k("p",Dt," Não há telas no totem "+D(o.value.name),1))]),_:1}),l(N,{cols:"12",class:"d-flex justify-end"},{default:i(()=>[l(B,{onClick:Se,class:"mr-3",variant:"tonal",color:"gray"},{default:i(()=>[L("Cancelar")]),_:1}),l(B,{onClick:Ce,variant:"tonal",color:"primary"},{default:i(()=>[L("Salvar")]),_:1})]),_:1})]),_:1}),l(tt,{modelValue:_.value.visible,"onUpdate:modelValue":a[2]||(a[2]=u=>_.value.visible=u),screens:_.value.screens,actualScreenIndex:_.value.activeIndex,"onUpdate:actualScreenIndex":a[3]||(a[3]=u=>_.value.activeIndex=u)},null,8,["modelValue","screens","actualScreenIndex"]),l(wt,{modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=u=>d.value=u),"screen-totem":p.value,onSave:S,"onScreen:delete":ge,"onField:remove":Te},null,8,["modelValue","screen-totem"])]),_:1}))}}),nl=me(Nt,[["__scopeId","data-v-84065c5d"]]);export{nl as default};
