import{_ as I}from"./Dialog.vue_vue_type_script_setup_true_lang-B3VUjE2l.js";import{aH as w,Y as D,r as _,aF as L,c as y,a1 as T,a2 as U,a3 as f,h as b,i as P,bB as R,a6 as C,ag as j,a5 as F,ab as B,a8 as $,ac as q,ao as z}from"./index-BKCAMHtB.js";import{V as H,_ as G}from"./Form.vue_vue_type_script_setup_true_lang-B9xE6XiO.js";import{d as N}from"./default-values-CbD4zaFl.js";import{V as M}from"./VForm-B8sy0Rqc.js";function oe(){return w.get("/attendance-type")}function O(r){return w.post("/attendance-type",r)}function Y(r,m){return m.append("_method","PUT"),w.post(`/attendance-type/${r}`,m)}function le(r){return w.delete(`/attendance-type/${r}`)}const J={key:0,class:"d-flex align-center"},K=["src"],Q={key:0,class:"d-flex justify-end mb-3"},W=D({__name:"AttendanceTypeForm",props:{modelValue:{},hideActions:{type:Boolean,default:!1}},emits:["update:modelValue","submit","cancel"],setup(r,{expose:m,emit:g}){const d=_(!1),{openAlert:v}=L(),c=r;m({save:A});const p=g,a=y({get(){return E(),c.modelValue},set:l=>p("update:modelValue",l)}),s=y(()=>a.value.id?"Atualizar":"Salvar"),o=_({file:[],base64:""}),i=y(()=>({eddited:o.value.base64.length>0,preview:a.value.icon.length?a.value.icon:o.value.base64})),V=_(!1),k=_([{component:"VTextField",value:"name",label:"Nome",required:!0,props:{trueValue:1,falseValue:0},on:{},cols:{cols:6,md:12}},{component:"VFileInput",value:"icon",label:"Ícone",required:!0,props:{trueValue:1,falseValue:0},on:{change:async()=>{a.value.icon="",S(o.value.file[0]).then(l=>{o.value.base64=l})}},cols:{cols:6,md:12}},{component:"VTextarea",value:"description",label:"Descrição",props:{trueValue:1,falseValue:0},on:{},cols:{cols:6,md:12}}]);function S(l){return new Promise((e,t)=>{const n=new FileReader;n.readAsDataURL(l),n.onload=()=>e(n.result),n.onerror=()=>t(n.result)})}function A(){if(!d.value)return;V.value=!0;const{icon:l,...e}=a.value,t=new FormData;Object.entries(e).forEach(([u,h])=>{h&&t.append(u,h)}),i.value.eddited&&t.set("icon",o.value.file[0]);const n=a.value.id?Y(a.value.id,t):O(t);n.then(u=>(p("submit",n),x(),u)).catch(u=>{v("Erro ao salvar tipo de atendimento",u)}).finally(()=>{V.value=!1})}function x(){p("update:modelValue",structuredClone(N.attendanceType)),o.value.base64="",o.value.file=[]}async function E(){var u;const l=c.modelValue.icon;if(!l)return;const e=await fetch(l,{method:"GET",mode:"no-cors"}),t=await e.blob(),n=(u=l.match(/[^/]*$/))==null?void 0:u[0];o.value.file=[new File([t],n??"Não identificado",{type:e.headers.get("Content-Type")})]}return(l,e)=>(T(),U(M,{onSubmit:z(A,["prevent"]),"lazy-validation":"",modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t)},{default:f(()=>[b(G,{form:k.value,modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value=t)},{"item:icon":f(({props:t,on:n})=>[b(H,P({modelValue:o.value.file,"onUpdate:modelValue":e[0]||(e[0]=u=>o.value.file=u)},R(n),t),{"prepend-inner":f(()=>[i.value.preview?(T(),C("div",J,[j("img",{width:"30",src:i.value.preview,height:"30"},null,8,K)])):F("",!0)]),_:2},1040,["modelValue"])]),_:1},8,["form","modelValue"]),l.hideActions?F("",!0):(T(),C("div",Q,[b($,{variant:"text",disabled:V.value,onClick:e[2]||(e[2]=t=>{x(),p("cancel")})},{default:f(()=>[B(" Cancelar ")]),_:1},8,["disabled"]),b($,{type:"submit",variant:"text",color:"primary",disabled:V.value,loading:V.value},{default:f(()=>[B(q(s.value),1)]),_:1},8,["disabled","loading"])]))]),_:1},8,["modelValue"]))}}),ne=D({__name:"AttendanceTypeDialog",props:{modelValue:{type:Boolean},item:{}},emits:["update:modelValue","update:item","submit"],setup(r,{emit:m}){const g=r,d=m,v=y({get(){return g.item},set:a=>d("update:item",a)}),c=y({get(){return g.modelValue},set:a=>d("update:modelValue",a)});function p(){v.value=structuredClone(N.attendanceType)}return(a,s)=>{const o=I;return T(),U(o,{modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=i=>c.value=i),title:"Tipo de Atendimento","hide-actions":"",onClose:p},{content:f(()=>[b(W,{ref:"form",modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=i=>v.value=i),onCancel:s[1]||(s[1]=i=>c.value=!1),onSubmit:s[2]||(s[2]=i=>{c.value=!1,d("submit")})},null,8,["modelValue"])]),_:1},8,["modelValue"])}}});export{ne as _,le as d,oe as g};
