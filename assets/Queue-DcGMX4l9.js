import{_ as T}from"./LayoutView.vue_vue_type_script_setup_true_lang-DyaN_xGe.js";import{_ as U}from"./Dialog.vue_vue_type_script_setup_true_lang-DRnDC6on.js";import{u as B,c as S,g as A,d as P}from"./queue.repository-BLD8I8xB.js";import{Y as I,aE as L,c as w,r as m,a0 as F,a1 as N,a2 as a,h as i,ad as R,o as j,a6 as E,a8 as $,ab as b,a4 as z,ac as D,a3 as M,V as G,i as O,F as k,a7 as W,b9 as Y}from"./index-CDl_QKVk.js";import{V as H}from"./Form.vue_vue_type_script_setup_true_lang-BaCq78p9.js";import{r as J}from"./VDataTable-Dh_CZyGv.js";import{V as K}from"./filter-c6zobYp7.js";import{b as X,V as Z,c as ee}from"./VList-9HnQ1n-1.js";import"./VRow-Bt3TskwR.js";import"./VSheet-B4KFF7X7.js";import"./VForm-CGAQok5a.js";import"./VTextField-C3d9AFbr.js";import"./VSlideGroup-DjE8cQEw.js";import"./VTooltip-JSQoz77F.js";import"./validator-yckjBK8X.js";import"./ssrBoot-CeZ-lE3a.js";const te=I({__name:"QueueDialog",props:{modelValue:{type:Boolean},queue:{}},emits:["update:modelValue","update:queue","save"],setup(h,{emit:y}){const{openAlert:x}=L(),s=h,g=y,V=w({get:()=>s.modelValue,set:o=>g("update:modelValue",o)}),d=m(!1),r=m([]),p=m(!1),c=w({get:()=>(f(),s.queue),set:o=>{g("update:queue",o)}}),q=w(()=>{var o;return!!((o=s==null?void 0:s.queue)!=null&&o.id)}),_=w(()=>q.value?"Editar Fila":"Adicionar Fila"),u=m({title:_,form:{value:c,inputs:[{component:"VTextField",value:"name",label:"Nome",required:!0,on:{}},{component:"VFileInput",value:"icon_src",label:"Ícone",required:!0},{component:"VTextarea",value:"description",label:"Descrição",on:{}}]},submit:()=>e()});function e(){p.value=!0;const{icon_src:o,...l}=c.value,n=new FormData;Object.entries(l).forEach(([v,Q])=>{n.append(v,Q)}),d.value&&n.set("icon_src",r.value[0]),(q.value?B(s.queue.id,n):S(n)).then(()=>{t(),g("save")}).catch(v=>{x("Falha na requisição",v)}).finally(()=>{p.value=!1})}function t(){V.value=!1,d.value=!1,r.value=[],c.value={name:"",status:null,description:"",icon_src:"",created_at:"",updated_at:""}}async function f(){var v;const o=s.queue.icon_src;if(!o)return;const l=await fetch(o,{method:"GET",mode:"no-cors"}),n=await l.blob(),C=(v=o.match(/[^/]*$/))==null?void 0:v[0];r.value=[new File([n],C??"Não identificado",{type:l.headers.get("Content-Type")})]}return(o,l)=>(F(),N(U,{onClose:t,loading:p.value,modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=n=>V.value=n),width:"400",form:u.value,"onUpdate:form":l[3]||(l[3]=n=>u.value=n)},{"item:icon_src":a(()=>[i(H,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=n=>r.value=n),onChange:l[1]||(l[1]=n=>d.value=!0),required:"",accept:"image/*",multiple:!1,chips:""},null,8,["modelValue"])]),_:2},1032,["loading","modelValue","form"]))}}),_e=I({__name:"Queue",setup(h){const y=[{title:"ID",value:"id",align:"start",width:"5%"},{title:"Nome",value:"name",align:"start",width:"25%"},{title:"Descrição",value:"description",align:"start",width:"40%"},{title:"Ícone",value:"icon_src",align:"start",width:"5%"},{title:"Última atualização",value:"updated_at",align:"start",width:"25%"},{title:"",value:"actions",align:"start",width:"10%"}],{openAlert:x,closeAlert:s,openConfirmAlert:g}=L(),{setBreadcrumbs:V}=R();V([{title:"Filas",name:"true",to:""}]);const d=m(!1),r=m(!0),p=m([]),c=m({id:0,name:"",status:null,description:"",icon_src:"",created_at:"",updated_at:""}),q=m([{title:"Editar",action:u=>{c.value={...u},d.value=!0}},{title:"Excluir",action:u=>{g({title:"Remover fila",text:`Deseja realmente remover a fila <span class="text-no-wrap bg-primary pa-1 rounded"> ${u.name}</span>?`},e=>{e.value=!0,P(u.id).finally(()=>{e.value=!1,s(),_(!1)})})}}]);function _(u=!0){u&&(r.value=!0),A().then(e=>{p.value=e.data}).catch(e=>{console.log({error:e}),x("Erro ao carregar totens",e)}).finally(()=>{r.value=!1})}return j(()=>{_()}),(u,e)=>(F(),E(k,null,[i(T,{icon:"mdi-format-list-bulleted",title:"Filas"},{action:a(()=>[i($,{color:"primary",flat:"",onClick:e[0]||(e[0]=t=>d.value=!0)},{default:a(()=>[b(" Novo ")]),_:1})]),content:a(()=>[i(J,{headers:y,items:p.value,loading:r.value},{"item.name":a(({item:t})=>[i(z(Y),{to:{name:"totem.view"}},{default:a(()=>[b(D(t.name),1)]),_:2},1032,["to"])]),"item.icon_src":a(({item:t})=>[i(M,{src:t.icon_src,width:"42"},null,8,["src"])]),"item.updated_at":a(({item:t})=>[i(G,{icon:"mdi-calendar"}),b(" "+D(new Date(t.updated_at).toLocaleString()),1)]),bottom:a(()=>[]),"item.actions":a(({item:t})=>[i(K,null,{activator:a(({props:f})=>[i($,O({icon:"mdi-dots-horizontal",variant:"text"},f),null,16)]),default:a(()=>[i(X,null,{default:a(()=>[(F(!0),E(k,null,W(q.value,f=>(F(),N(Z,{link:"",onClick:o=>f.action(t)},{default:a(()=>[i(ee,null,{default:a(()=>[b(D(f.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items","loading"])]),_:1}),i(te,{onSave:e[1]||(e[1]=t=>_(!1)),modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t),queue:c.value,"onUpdate:queue":e[3]||(e[3]=t=>c.value=t)},null,8,["modelValue","queue"])],64))}});export{_e as default};
